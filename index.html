<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Learn Hub - Quiz Interactifs</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <style>
        :root {
            --primary: #113E21;
            --secondary: #B38B59;
            --accent: #3F0F0F;
            --light: #FEFEFE;
        }
        
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: var(--light);
        }
        
        .hero-gradient { 
            background: linear-gradient(135deg, var(--light) 0%, #f5f5f5 100%); 
        }
        
        .card-hover { 
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.1); 
        }
        
        .card-hover:hover { 
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        /* Animations innovantes */
        @keyframes floatIn {
            0% { opacity: 0; transform: translateY(20px) rotate(2deg); }
            100% { opacity: 1; transform: translateY(0) rotate(0); }
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        @keyframes wave {
            0% { transform: rotate(0deg); }
            25% { transform: rotate(5deg); }
            50% { transform: rotate(0deg); }
            75% { transform: rotate(-5deg); }
            100% { transform: rotate(0deg); }
        }
        
        .float-in { 
            animation: floatIn 0.6s ease-out forwards; 
        }
        
        .pulse-hover:hover {
            animation: pulse 1.5s infinite;
        }
        
        .wave-hover:hover {
            animation: wave 1s ease-in-out;
        }
        
        .page { 
            display: none;
            opacity: 0;
            transition: opacity 0.5s ease;
        }
        
        .page.active { 
            display: flex;
            opacity: 1;
        }
        
        /* Style pour le lien de navigation actif */
        .nav-link.active {
            color: var(--secondary);
            position: relative;
        }
        
        .nav-link.active::after {
            content: '';
            position: absolute;
            bottom: -4px;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, var(--secondary), var(--primary));
            border-radius: 3px;
        }
        
        /* Animation pour la barre de progression */
        @keyframes progress-bar-animation {
            from { width: 0%; }
            to { width: var(--progress); }
        }
        
        .progress-bar-animated {
            animation: progress-bar-animation 1.2s cubic-bezier(0.65, 0, 0.35, 1) forwards;
        }
        
        /* Bouton sp√©cial */
        .special-btn {
            background: linear-gradient(135deg, var(--secondary), var(--primary));
            color: white;
            position: relative;
            overflow: hidden;
            transition: all 0.3s;
        }
        
        .special-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: all 0.6s;
        }
        
        .special-btn:hover::before {
            left: 100%;
        }
        
        /* Input focus effet */
        .focus-effect:focus {
            box-shadow: 0 0 0 3px rgba(179, 139, 89, 0.3);
            border-color: var(--secondary);
        }
    </style>
</head>
<body class="bg-[#FEFEFE] text-[#113E21] flex items-center justify-center min-h-screen p-4">

    <div id="app-container" class="w-full max-w-7xl bg-white rounded-2xl shadow-xl overflow-hidden transition-all duration-300 hover:shadow-2xl">

        <!-- ===== PAGE D'ACCUEIL (Landing Page) ===== -->
        <div id="landing-page" class="page active flex-col">
            <nav class="bg-white/90 backdrop-blur-md shadow-sm sticky top-0 z-40">
                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                    <div class="flex justify-between items-center h-16">
                        <a href="#" class="flex items-center gap-2 text-2xl font-bold text-[#113E21] transition-transform hover:scale-105 wave-hover">
                            <svg class="w-8 h-8" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 2L3 7V17L12 22L21 17V7L12 2Z" stroke="#B38B59" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M12 22V12" stroke="#B38B59" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M7 7L12 10L17 7" stroke="#B38B59" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M7 17L12 20L17 17" stroke="#B38B59" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M7 12L12 15L17 12" stroke="#B38B59" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            <span class="text-[#113E21]">Smart</span><span class="text-[#B38B59]">Learn</span><span class="text-[#3F0F0F]">Hub</span>
                        </a>
                        <button id="goto-auth-btn" class="special-btn font-semibold py-2 px-5 rounded-lg transition-all">Connexion</button>
                    </div>
                </div>
            </nav>
            
            <header class="hero-gradient text-center py-20 px-4">
                <h1 class="text-4xl md:text-5xl font-extrabold text-[#113E21] mb-4 float-in">Testez vos connaissances.</h1>
                <p class="mt-4 max-w-2xl mx-auto text-lg text-[#B38B59] float-in" style="animation-delay: 0.2s">Plongez dans nos quiz interactifs et stimulants.</p>
                <a href="#quiz-section-landing" class="mt-8 special-btn font-bold py-3 px-8 rounded-full text-lg transition transform hover:scale-105 inline-block float-in" style="animation-delay: 0.4s">Voir les Quiz</a>
                
                <div class="mt-12 animate-bounce" style="animation-delay: 1s">
                    <i class="fas fa-chevron-down text-[#B38B59] text-2xl"></i>
                </div>
            </header>
            
            <main id="quiz-section-landing" class="py-16">
                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                    <h2 class="text-3xl font-bold text-center mb-12 text-[#113E21]">Choisissez votre d√©fi</h2>
                    <div id="landing-quiz-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></div>
                </div>
            </main>
        </div>

        <!-- ===== PAGES D'AUTHENTIFICATION ===== -->
        <div id="auth-pages" class="page min-h-[90vh] flex-col justify-center items-center p-4 bg-[#FEFEFE]">
            <div id="login-page" class="w-full max-w-md">
                <div class="text-center mb-8">
                    <a href="#" class="flex items-center justify-center gap-2 text-3xl font-bold text-[#113E21] transition-transform hover:scale-105 wave-hover">
                        <svg class="w-10 h-10" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 2L3 7V17L12 22L21 17V7L12 2Z" stroke="#B38B59" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M12 22V12" stroke="#B38B59" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M7 7L12 10L17 7" stroke="#B38B59" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M7 17L12 20L17 17" stroke="#B38B59" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M7 12L12 15L17 12" stroke="#B38B59" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <div><span class="text-[#113E21]">Smart</span><span class="text-[#B38B59]">Learn</span><span class="text-[#3F0F0F]">Hub</span></div>
                    </a>
                    <h1 class="text-4xl font-extrabold text-[#113E21] mt-4">Bienvenue !</h1>
                    <p class="text-[#B38B59]">Connectez-vous pour continuer votre apprentissage.</p>
                </div>
                
                <div class="space-y-4 mb-6">
                    <button class="w-full flex items-center justify-center py-3 px-4 border border-[#B38B59] bg-white text-[#113E21] rounded-lg hover:bg-[#F5F5F5] transition font-semibold pulse-hover">
                        <img src="https://www.google.com/favicon.ico" class="w-5 h-5 mr-3" alt="Google logo"> Continuer avec Google
                    </button>
                    <button class="w-full flex items-center justify-center py-3 px-4 bg-[#1877F2] text-white rounded-lg hover:bg-[#166eeb] transition font-semibold pulse-hover">
                        <i class="fab fa-facebook-f mr-3"></i> Continuer avec Facebook
                    </button>
                </div>
                
                <div class="flex items-center my-4">
                    <hr class="w-full border-[#B38B59]"/>
                    <p class="px-2 text-xs text-[#B38B59] font-semibold">OU</p>
                    <hr class="w-full border-[#B38B59]"/>
                </div>
                
                <div id="login-error" class="text-red-600 bg-red-100 p-3 rounded-lg mb-4 text-sm hidden"></div>
                
                <form id="login-form">
                    <div class="mb-4">
                        <input type="text" id="login-nickname" placeholder="Pseudo ou Email" required 
                               class="w-full px-4 py-3 border border-[#B38B59] rounded-lg focus-effect focus:ring-[#B38B59] focus:border-[#B38B59]">
                    </div>
                    <div class="mb-4 relative">
                        <input type="password" id="login-password" placeholder="Mot de passe" required 
                               class="w-full px-4 py-3 border border-[#B38B59] rounded-lg focus-effect focus:ring-[#B38B59] focus:border-[#B38B59]">
                        <button type="button" class="toggle-password absolute top-1/2 right-4 -translate-y-1/2 text-[#B38B59] hover:text-[#3F0F0F]">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                    <div class="text-right mb-6">
                        <a href="#" class="text-sm font-semibold text-[#B38B59] hover:text-[#3F0F0F]">Mot de passe oubli√© ?</a>
                    </div>
                    <button type="submit" class="w-full special-btn font-bold py-3 rounded-lg transition shadow-sm hover:shadow-md">
                        Se connecter
                    </button>
                </form>
                
                <p class="text-center text-sm text-[#113E21] mt-6">
                    Pas encore de compte ? 
                    <a href="#" id="goto-register" class="font-semibold text-[#B38B59] hover:text-[#3F0F0F]">Inscrivez-vous</a>
                </p>
            </div>
            
            <div id="register-page" class="w-full max-w-md hidden">
                <h1 class="text-3xl font-bold text-center mb-2 text-[#113E21]">Cr√©er un compte</h1>
                <p class="text-[#B38B59] mb-6 text-center">Rejoignez notre communaut√© d'apprenants.</p>
                
                <div id="register-error" class="text-red-600 bg-red-100 p-3 rounded-lg mb-4 text-sm hidden"></div>
                <div id="register-success" class="text-green-600 bg-green-100 p-3 rounded-lg mb-4 text-sm hidden"></div>
                
                <form id="register-form">
                    <div class="space-y-4">
                        <input type="text" id="register-fullname" placeholder="Nom complet" required 
                               class="w-full px-4 py-3 border border-[#B38B59] rounded-lg focus-effect focus:ring-[#B38B59] focus:border-[#B38B59]">
                        <input type="email" id="register-email" placeholder="Email" required 
                               class="w-full px-4 py-3 border border-[#B38B59] rounded-lg focus-effect focus:ring-[#B38B59] focus:border-[#B38B59]">
                        <input type="text" id="register-nickname" placeholder="Pseudo" required 
                               class="w-full px-4 py-3 border border-[#B38B59] rounded-lg focus-effect focus:ring-[#B38B59] focus:border-[#B38B59]">
                        <div class="relative">
                            <input type="password" id="register-password" placeholder="Mot de passe (8+ caract√®res)" required 
                                   class="w-full px-4 py-3 border border-[#B38B59] rounded-lg focus-effect focus:ring-[#B38B59] focus:border-[#B38B59]">
                            <button type="button" class="toggle-password absolute top-1/2 right-4 -translate-y-1/2 text-[#B38B59] hover:text-[#3F0F0F]">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                    <button type="submit" class="w-full special-btn font-bold py-3 rounded-lg hover:bg-opacity-90 transition mt-6">
                        S'inscrire
                    </button>
                </form>
                
                <p class="text-center text-sm text-[#113E21] mt-6">
                    D√©j√† un compte ? 
                    <a href="#" id="goto-login" class="font-semibold text-[#B38B59] hover:text-[#3F0F0F]">Connectez-vous</a>
                </p>
            </div>
        </div>
        
        <!-- ===== CONTENU DE L'APPLICATION (pour utilisateur connect√©) ===== -->
        <div id="app-content" class="page flex-col min-h-[90vh]">
            <header class="bg-white shadow-sm sticky top-0 z-30">
                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                    <div class="flex justify-between items-center h-16">
                        <div class="logo text-xl font-bold text-[#113E21] transition-transform hover:scale-105 wave-hover">
                            <svg class="w-6 h-6 inline mr-1" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 2L3 7V17L12 22L21 17V7L12 2Z" stroke="#B38B59" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M12 22V12" stroke="#B38B59" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M7 7L12 10L17 7" stroke="#B38B59" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M7 17L12 20L17 17" stroke="#B38B59" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M7 12L12 15L17 12" stroke="#B38B59" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            Smart Learn Hub
                        </div>
                        
                        <!-- Navigation Desktop -->
                        <nav class="hidden md:flex items-center space-x-8">
                            <a href="#" class="nav-link text-[#113E21] hover:text-[#B38B59] font-semibold" data-page="home-page">Accueil</a>
                            <a href="#" class="nav-link text-[#113E21] hover:text-[#B38B59] font-semibold" data-page="courses-page">Mes Cours</a>
                            <a href="#" class="nav-link text-[#113E21] hover:text-[#B38B59] font-semibold" data-page="profile-page">Profil</a>
                        </nav>
                        
                        <button class="logout-btn hidden md:flex items-center special-btn font-semibold py-2 px-4 rounded-lg transition">
                            <i class="fas fa-sign-out-alt mr-2"></i>D√©connexion
                        </button>
                        
                        <!-- Bouton Hamburger pour mobile -->
                        <button id="hamburger-btn" class="md:hidden text-2xl text-[#B38B59]">
                            <i class="fas fa-bars"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Menu Mobile -->
                <div id="mobile-menu" class="md:hidden hidden bg-white border-t border-[#B38B59]">
                    <a href="#" class="nav-link block py-3 px-4 text-[#113E21] hover:bg-[#F5F5F5]" data-page="home-page">Accueil</a>
                    <a href="#" class="nav-link block py-3 px-4 text-[#113E21] hover:bg-[#F5F5F5]" data-page="courses-page">Mes Cours</a>
                    <a href="#" class="nav-link block py-3 px-4 text-[#113E21] hover:bg-[#F5F5F5]" data-page="profile-page">Profil</a>
                    <button class="logout-btn w-full text-left flex items-center py-3 px-4 text-red-600 hover:bg-red-50">
                        <i class="fas fa-sign-out-alt mr-2"></i>D√©connexion
                    </button>
                </div>
            </header>

            <div class="flex-grow relative bg-[#F5F5F5]">
                <!-- Page d'accueil -->
                <div id="home-page" class="page p-6 md:p-10 float-in">
                    <div class="text-center max-w-3xl mx-auto">
                        <h2 id="welcome-message" class="text-4xl font-bold mb-2 text-[#113E21]"></h2>
                        <p id="motivation-quote" class="text-lg text-[#B38B59] italic"></p>
                        
                        <div id="progress-widget" class="mt-8 text-left bg-white p-6 rounded-lg shadow-inner hidden">
                            <h3 class="font-bold text-lg text-[#113E21] mb-2">Votre Semaine en un Coup d'≈íil</h3>
                            <p id="progress-summary" class="text-[#3F0F0F]">Calcul en cours...</p>
                            <button id="resume-course-btn" class="mt-4 special-btn font-semibold py-2 px-4 rounded-lg transition hidden">
                                Reprendre le dernier cours
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Page des cours -->
                <div id="courses-page" class="page p-6 md:p-10 float-in">
                    <div class="max-w-7xl mx-auto">
                        <h2 class="text-3xl font-bold mb-8 text-[#113E21]">Mati√®res disponibles</h2>
                        <div id="courses-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></div>
                    </div>
                </div>
                
                <!-- Page de profil -->
                <div id="profile-page" class="page p-6 md:p-10 float-in justify-center items-center">
                    <div id="profile-card" class="w-full max-w-2xl bg-white p-8 rounded-xl shadow-lg relative"></div>
                </div>
                
                <!-- Page de quiz -->
                <div id="quiz-page" class="page p-6 md:p-10 float-in justify-center">
                    <div class="w-full max-w-2xl">
                        <h2 id="quiz-title" class="text-3xl font-bold text-center mb-8 text-[#113E21]"></h2>
                        
                        <div id="question-container" class="bg-white p-8 rounded-lg shadow-md">
                            <p id="question-text" class="text-xl font-semibold mb-6 text-[#113E21]"></p>
                            <div id="options-container" class="flex flex-col gap-4"></div>
                        </div>
                        
                        <div class="text-center mt-6">
                            <button id="next-question-btn" class="special-btn font-semibold py-2 px-6 rounded-lg transition hidden">
                                Question suivante
                            </button>
                        </div>
                        
                        <div id="quiz-results" class="text-center bg-white p-8 rounded-lg shadow-md hidden">
                            <h3 class="text-3xl font-bold mb-4 text-[#113E21]">üéâ Quiz Termin√© ! üéâ</h3>
                            <p id="final-score" class="text-2xl text-[#B38B59] mb-6"></p>
                            <button id="back-to-courses-btn" class="special-btn font-semibold py-3 px-6 rounded-lg transition">
                                Retour aux cours
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- MODAL DE D√âTAIL DU COURS -->
        <div id="course-detail-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 hidden">
            <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-lg w-full m-4 float-in">
                <div class="flex justify-between items-start">
                    <div>
                        <h2 id="modal-course-title" class="text-3xl font-bold text-[#113E21]"></h2>
                        <p id="modal-course-professor" class="text-md text-[#B38B59] mt-1"></p>
                    </div>
                    <button onclick="document.getElementById('course-detail-modal').classList.add('hidden')" class="text-[#B38B59] hover:text-[#3F0F0F] text-2xl">&times;</button>
                </div>
                
                <p id="modal-course-description" class="text-[#3F0F0F] my-6"></p>
                
                <div class="flex flex-col sm:flex-row gap-4">
                    <a id="modal-pdf-btn" href="#" target="_blank" class="w-full text-center bg-[#F5F5F5] text-[#113E21] font-semibold py-3 px-4 rounded-lg hover:bg-[#E0E0E0] transition">
                        <i class="fas fa-file-pdf mr-2"></i> Voir le cours (PDF)
                    </a>
                    <button id="modal-start-quiz-btn" class="w-full special-btn font-semibold py-3 px-4 rounded-lg transition">
                        <i class="fas fa-play-circle mr-2"></i> Commencer le Quiz
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- State and DOM Elements ---
        const state = { 
            user: null, 
            courses: null, 
            currentQuiz: { 
                subject: null, 
                questions: [], 
                currentQuestionIndex: 0, 
                score: 0 
            } 
        };
        
        const dom = {
            allMainPages: document.querySelectorAll('#app-container > .page'),
            auth: {
                container: document.getElementById('auth-pages'),
                loginPage: document.getElementById('login-page'),
                registerPage: document.getElementById('register-page'),
                loginForm: document.getElementById('login-form'),
                registerForm: document.getElementById('register-form'),
                loginError: document.getElementById('login-error'),
                registerError: document.getElementById('register-error'),
                registerSuccess: document.getElementById('register-success'),
            },
            app: {
                content: document.getElementById('app-content'),
                appSubPages: document.querySelectorAll('#app-content .page'),
                navLinks: document.querySelectorAll('.nav-link'),
                mobileMenu: document.getElementById('mobile-menu'),
                hamburgerBtn: document.getElementById('hamburger-btn'),
                coursesGrid: document.getElementById('courses-grid'),
                welcomeMsg: document.getElementById('welcome-message'),
                motivationQuote: document.getElementById('motivation-quote'),
                progressWidget: document.getElementById('progress-widget'),
                progressSummary: document.getElementById('progress-summary'),
                resumeCourseBtn: document.getElementById('resume-course-btn'),
                profileCard: document.getElementById('profile-card'),
                quiz: {
                    title: document.getElementById('quiz-title'),
                    questionContainer: document.getElementById('question-container'),
                    questionText: document.getElementById('question-text'),
                    optionsContainer: document.getElementById('options-container'),
                    nextBtn: document.getElementById('next-question-btn'),
                    resultsContainer: document.getElementById('quiz-results'),
                    finalScore: document.getElementById('final-score'),
                    backToCoursesBtn: document.getElementById('back-to-courses-btn')
                }
            },
            modal: {
                container: document.getElementById('course-detail-modal'),
                title: document.getElementById('modal-course-title'),
                professor: document.getElementById('modal-course-professor'),
                description: document.getElementById('modal-course-description'),
                pdfBtn: document.getElementById('modal-pdf-btn'),
                startQuizBtn: document.getElementById('modal-start-quiz-btn'),
            }
        };

        const quotes = [
            "Le seul mauvais savoir est celui que l'on croit avoir.",
            "L'apprentissage est un tr√©sor qui suivra son propri√©taire partout.",
            "Investir dans le savoir rapporte les meilleurs int√©r√™ts.",
            "La connaissance s'acquiert par l'exp√©rience, tout le reste n'est que de l'information.",
            "Dites-moi et j'oublie. Enseignez-moi et je me souviens. Impliquez-moi et j'apprends."
        ];

        // --- Navigation Functions ---
        const showPage = (pageId) => {
            dom.allMainPages.forEach(p => {
                p.classList.remove('active');
                p.style.opacity = 0;
            });
            
            const target = document.getElementById(pageId);
            if(target) {
                target.classList.add('active');
                setTimeout(() => {
                    target.style.opacity = 1;
                }, 10);
            }
        };
        
        const showAuthForm = (form) => {
            showPage('auth-pages');
            dom.auth.loginPage.classList.toggle('hidden', form !== 'login');
            dom.auth.registerPage.classList.toggle('hidden', form !== 'register');
        };
        
        const showAppPage = (pageId) => {
            showPage('app-content');
            dom.app.appSubPages.forEach(p => p.classList.remove('active'));
            
            const target = document.getElementById(pageId);
            if (target) {
                target.classList.add('active');
                target.style.opacity = 1;
            }

            // Mettre √† jour le lien de navigation actif
            dom.app.navLinks.forEach(link => {
                link.classList.toggle('active', link.dataset.page === pageId);
            });
            
            dom.app.mobileMenu.classList.add('hidden'); // Cacher le menu mobile apr√®s la navigation
        };

        // --- UI Helper Functions ---
        const showError = (el, msg) => { 
            el.textContent = msg; 
            el.classList.remove('hidden');
            el.classList.add('float-in');
        };
        
        const clearError = (el) => { 
            el.textContent = ''; 
            el.classList.add('hidden');
            el.classList.remove('float-in');
        }

        // --- Rendering Functions ---
        const renderLandingQuizzes = (courses) => {
            const container = document.getElementById('landing-quiz-container');
            if (!container) return;
            
            container.innerHTML = Object.entries(courses).map(([key, course]) => `
                <div class="card-hover bg-white rounded-xl shadow-md p-6 text-center float-in" style="animation-delay: ${0.1 * parseInt(key)}s">
                    <div class="text-4xl mb-4">${course.emoji}</div>
                    <h3 class="text-xl font-bold mb-2 text-[#113E21]">${course.title}</h3>
                    <p class="text-[#B38B59] mb-4 h-12">${course.description}</p>
                    <button class="goto-auth-btn w-full bg-[#F5F5F5] text-[#113E21] font-semibold py-2 px-4 rounded-lg hover:bg-[#E0E0E0] transition">
                        Commencer
                    </button>
                </div>
            `).join('');
            
            document.querySelectorAll('.goto-auth-btn').forEach(btn => {
                btn.addEventListener('click', () => showAuthForm('login'));
            });
        };
        
        const renderHomePage = () => {
            const firstName = state.user.fullName.split(' ')[0];
            dom.app.welcomeMsg.textContent = `Bienvenue, ${firstName} !`;
            
            const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];
            dom.app.motivationQuote.textContent = `"${randomQuote}"`;

            // Mettre √† jour le widget de progression
            const completedCourses = Object.values(state.user.progress).filter(score => score >= 100).length;
            dom.app.progressSummary.textContent = `Vous avez termin√© ${completedCourses} cours jusqu'√† pr√©sent. Continuez comme √ßa ! üëç`;
            dom.app.progressWidget.classList.remove('hidden');
            
            // Afficher le bouton "Reprendre" si un cours est en cours
            const inProgressCourses = Object.entries(state.user.progress).filter(([_, score]) => score > 0 && score < 100);
            if (inProgressCourses.length > 0) {
                dom.app.resumeCourseBtn.classList.remove('hidden');
                dom.app.resumeCourseBtn.textContent = `Reprendre ${inProgressCourses[0][0]}`;
                dom.app.resumeCourseBtn.dataset.subject = inProgressCourses[0][0];
            }
        };
        
        const renderCoursesPage = () => {
            dom.app.coursesGrid.innerHTML = Object.entries(state.courses).map(([subject, course], index) => {
                const progress = state.user.progress[subject] || 0;
                return `
                <div class="card-hover bg-white rounded-lg shadow p-6 flex flex-col relative float-in" style="animation-delay: ${0.1 * index}s">
                    <div class="absolute top-2 right-2 bg-[#F5F5F5] text-[#B38B59] text-xs font-bold px-2 py-1 rounded-full">
                        ${progress > 0 ? 'En cours' : 'D√©butant'}
                    </div>
                    <p class="text-sm font-medium text-[#B38B59]">${course.professor}</p>
                    <h3 class="text-2xl font-bold my-2 text-[#113E21]">${course.emoji} ${course.title}</h3>
                    <p class="text-[#3F0F0F] text-sm flex-grow mb-4">${course.description}</p>
                    <div class="w-full bg-[#F5F5F5] rounded-full h-2.5 mb-4">
                        <div class="bg-gradient-to-r from-[#B38B59] to-[#113E21] h-2.5 rounded-full" style="width: ${progress}%"></div>
                    </div>
                    <button class="open-course-detail-btn mt-auto w-full bg-[#113E21] text-white font-semibold py-2 px-4 rounded-lg hover:bg-opacity-90 transition" data-subject="${subject}">
                        Voir le cours
                    </button>
                </div>`;
            }).join('');
        };
        
        const renderProfilePage = () => {
            const total = Object.values(state.user.progress).reduce((s, v) => s + v, 0);
            const avg = Object.keys(state.courses).length > 0 ? Math.round(total / Object.keys(state.courses).length) : 0;
            const initials = state.user.fullName.split(' ').map(n => n[0]).join('').toUpperCase();

            dom.app.profileCard.innerHTML = `
                <div class="flex flex-col items-center text-center">
                    <div class="relative mb-4">
                        <div class="w-24 h-24 bg-gradient-to-br from-[#B38B59] to-[#113E21] rounded-full flex items-center justify-center text-white text-4xl font-bold">
                            ${initials}
                        </div>
                    </div>
                    <h2 class="text-3xl font-bold text-[#113E21]">${state.user.fullName}</h2>
                    <p class="text-[#B38B59]">@${state.user.nickname}</p>
                    <p class="text-[#B38B59] mt-1">${state.user.email}</p>
                </div>
                <div class="mt-8">
                    <div class="flex justify-between items-center mb-1">
                        <h3 class="text-lg font-semibold text-[#113E21]">Progression Globale</h3>
                        <span class="font-bold text-[#B38B59]">${avg}%</span>
                    </div>
                    <div class="w-full bg-[#F5F5F5] rounded-full h-4">
                        <div class="progress-bar-animated bg-gradient-to-r from-[#B38B59] to-[#113E21] h-4 rounded-full" style="--progress: ${avg}%"></div>
                    </div>
                </div>
                <button class="absolute bottom-4 right-4 bg-[#F5F5F5] text-[#113E21] text-sm font-semibold py-2 px-3 rounded-lg hover:bg-[#E0E0E0] transition">
                    <i class="fas fa-pencil-alt mr-1"></i> Modifier
                </button>
            `;
        };
        
        const showCourseDetailModal = (subject) => {
            const course = state.courses[subject];
            dom.modal.title.textContent = course.title;
            dom.modal.professor.textContent = `Par ${course.professor}`;
            dom.modal.description.textContent = course.description;
            dom.modal.pdfBtn.href = `/courses/${course.pdf_link}`;
            dom.modal.pdfBtn.classList.toggle('hidden', !course.pdf_link);
            dom.modal.startQuizBtn.dataset.subject = subject;
            dom.modal.container.classList.remove('hidden');
        };

        // --- Core App Logic ---
        const loadAppData = async () => {
            try {
                const res = await fetch('/api/data');
                if (!res.ok) throw new Error('Non autoris√©');
                const data = await res.json();
                state.user = data.user;
                state.courses = data.courses;
                renderHomePage(); 
                renderCoursesPage(); 
                renderProfilePage();
                showAppPage('home-page');
            } catch (err) { 
                console.error(err); 
                logout(); 
            }
        };
        
        const checkSession = async () => {
            try {
                const res = await fetch('/api/check_session');
                const data = await res.json();
                if (data.logged_in) {
                    loadAppData();
                } else {
                    const coursesRes = await fetch('/api/courses');
                    const courses = await coursesRes.json();
                    renderLandingQuizzes(courses);
                    showPage('landing-page');
                }
            } catch (e) { 
                console.error(e); 
            }
        };
        
        const startQuiz = (subject) => {
            dom.modal.container.classList.add('hidden');
            fetch(`/api/quiz/${subject}`)
                .then(res => res.json())
                .then(questions => {
                    state.currentQuiz = { 
                        subject, 
                        questions, 
                        currentQuestionIndex: 0, 
                        score: 0 
                    };
                    
                    dom.app.quiz.title.textContent = state.courses[subject].title;
                    dom.app.quiz.resultsContainer.classList.add('hidden');
                    dom.app.quiz.questionContainer.style.display = 'block';
                    showAppPage('quiz-page');
                    renderQuestion();
                })
                .catch(err => console.error('Erreur au d√©marrage du quiz:', err));
        };
        
        const renderQuestion = () => {
            dom.app.quiz.nextBtn.classList.add('hidden');
            const { questions, currentQuestionIndex } = state.currentQuiz;
            const question = questions[currentQuestionIndex];
            
            dom.app.quiz.questionText.textContent = `(${currentQuestionIndex + 1}/${questions.length}) ${question.question}`;
            dom.app.quiz.optionsContainer.innerHTML = question.options.map((option, i) => 
                `<button class="option-btn w-full text-left p-4 border border-[#B38B59] bg-white text-[#113E21] rounded-lg hover:bg-[#F5F5F5] transition float-in" 
                        style="animation-delay: ${0.1 * i}s">
                    ${option}
                </button>`
            ).join('');
        };
        
        const handleAnswer = (selectedOption, button) => {
            const { questions, currentQuestionIndex } = state.currentQuiz;
            const question = questions[currentQuestionIndex];
            const isCorrect = selectedOption === question.answer;
            
            dom.app.quiz.optionsContainer.querySelectorAll('.option-btn').forEach(btn => {
                btn.disabled = true;
                if (btn.textContent === question.answer) {
                    btn.classList.remove('hover:bg-[#F5F5F5]');
                    btn.classList.add('bg-green-100', 'border-green-500', 'text-green-800');
                }
            });

            if (isCorrect) {
                state.currentQuiz.score++;
                button.classList.add('bg-green-100', 'border-green-500', 'text-green-800');
            } else {
                button.classList.remove('hover:bg-[#F5F5F5]');
                button.classList.add('bg-red-100', 'border-red-500', 'text-red-800');
            }
            
            dom.app.quiz.nextBtn.classList.remove('hidden');
        };
        
        const endQuiz = () => {
            const { score, questions, subject } = state.currentQuiz;
            const finalScorePercent = (score / questions.length) * 100;

            dom.app.quiz.questionContainer.style.display = 'none';
            dom.app.quiz.nextBtn.classList.add('hidden');
            dom.app.quiz.resultsContainer.classList.remove('hidden');
            
            let message = "";
            if (finalScorePercent >= 80) {
                message = "Excellent travail ! üéâ";
            } else if (finalScorePercent >= 60) {
                message = "Bon travail ! üëç";
            } else {
                message = "Continuez √† vous entra√Æner ! üí™";
            }
            
            dom.app.quiz.finalScore.textContent = `${message} Votre score : ${score} / ${questions.length} (${finalScorePercent.toFixed(0)}%)`;

            fetch('/api/progress', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ subject, score: finalScorePercent })
            }).then(() => {
                state.user.progress[subject] = Math.max(state.user.progress[subject] || 0, finalScorePercent);
            }).catch(err => console.error('Erreur de mise √† jour de la progression:', err));
        };
        
        const logout = () => { 
            fetch('/api/logout')
                .then(() => { 
                    state.user = null; 
                    state.courses = null; 
                    checkSession(); 
                })
                .catch(err => console.error('Erreur lors de la d√©connexion:', err));
        };

        // --- Event Listeners ---
        document.getElementById('goto-auth-btn').addEventListener('click', () => showAuthForm('login'));
        document.getElementById('goto-register').addEventListener('click', (e) => { 
            e.preventDefault(); 
            showAuthForm('register'); 
        });
        document.getElementById('goto-login').addEventListener('click', (e) => { 
            e.preventDefault(); 
            showAuthForm('login'); 
        });
        
        dom.app.navLinks.forEach(link => link.addEventListener('click', (e) => {
            e.preventDefault();
            const pageId = e.target.dataset.page;
            if(pageId === 'courses-page') renderCoursesPage();
            if(pageId === 'profile-page') renderProfilePage();
            showAppPage(pageId);
        }));

        dom.app.hamburgerBtn.addEventListener('click', () => {
            dom.app.mobileMenu.classList.toggle('hidden');
        });

        // Toggle Password Visibility
        document.querySelectorAll('.toggle-password').forEach(btn => {
            btn.addEventListener('click', () => {
                const input = btn.previousElementSibling;
                const icon = btn.querySelector('i');
                if (input.type === 'password') {
                    input.type = 'text';
                    icon.classList.remove('fa-eye');
                    icon.classList.add('fa-eye-slash');
                } else {
                    input.type = 'password';
                    icon.classList.remove('fa-eye-slash');
                    icon.classList.add('fa-eye');
                }
            });
        });

        dom.auth.loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            clearError(dom.auth.loginError);
            
            const body = { 
                nickname: dom.auth.loginForm.elements['login-nickname'].value, 
                password: dom.auth.loginForm.elements['login-password'].value 
            };
            
            try {
                const response = await fetch('/api/login', { 
                    method: 'POST', 
                    headers: { 'Content-Type': 'application/json' }, 
                    body: JSON.stringify(body) 
                });
                
                const data = await response.json();
                if (!response.ok) throw new Error(data.message || 'Erreur serveur.');
                
                if (data.success) {
                    loadAppData();
                }
            } catch (error) {
                showError(dom.auth.loginError, error.message || 'Erreur de connexion au serveur.');
            }
        });

        dom.auth.registerForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            clearError(dom.auth.registerError);
            
            const password = dom.auth.registerForm.elements['register-password'].value;
            if (password.length < 8) {
                showError(dom.auth.registerError, 'Le mot de passe doit faire au moins 8 caract√®res.');
                return;
            }
            
            const body = {
                fullName: dom.auth.registerForm.elements['register-fullname'].value,
                email: dom.auth.registerForm.elements['register-email'].value,
                nickname: dom.auth.registerForm.elements['register-nickname'].value,
                password: password
            };

            try {
                const response = await fetch('/api/register', { 
                    method: 'POST', 
                    headers: { 'Content-Type': 'application/json' }, 
                    body: JSON.stringify(body) 
                });
                
                if (!response.ok) {
                    const errData = await response.json().catch(() => ({ message: `Erreur serveur: ${response.status}` }));
                    throw new Error(errData.message);
                }
                
                const data = await response.json();
                if (data.success) {
                    dom.auth.registerForm.reset();
                    showError(dom.auth.registerSuccess, data.message);
                    setTimeout(() => { 
                        clearError(dom.auth.registerSuccess); 
                        showAuthForm('login'); 
                    }, 2000);
                }
            } catch (error) {
                console.error('Erreur lors de l\'inscription:', error);
                if (error instanceof SyntaxError) {
                    showError(dom.auth.registerError, "Erreur du serveur. La base de donn√©es est-elle initialis√©e ?");
                } else {
                    showError(dom.auth.registerError, error.message || 'Une erreur r√©seau est survenue. Veuillez r√©essayer.');
                }
            }
        });

        document.querySelectorAll('.logout-btn').forEach(btn => {
            btn.addEventListener('click', logout);
        });
        
        dom.app.coursesGrid.addEventListener('click', (e) => {
            const btn = e.target.closest('.open-course-detail-btn');
            if(btn) showCourseDetailModal(btn.dataset.subject);
        });

        dom.modal.startQuizBtn.addEventListener('click', (e) => {
            startQuiz(e.target.dataset.subject);
        });
        
        dom.app.quiz.optionsContainer.addEventListener('click', (e) => {
            const btn = e.target.closest('.option-btn');
            if(btn) handleAnswer(btn.textContent, btn);
        });
        
        dom.app.quiz.nextBtn.addEventListener('click', () => {
            state.currentQuiz.currentQuestionIndex++;
            if (state.currentQuiz.currentQuestionIndex < state.currentQuiz.questions.length) {
                renderQuestion();
            } else {
                endQuiz();
            }
        });
        
        dom.app.quiz.backToCoursesBtn.addEventListener('click', () => { 
            renderCoursesPage(); 
            showAppPage('courses-page'); 
        });
        
        dom.app.resumeCourseBtn?.addEventListener('click', function() {
            showCourseDetailModal(this.dataset.subject);
        });

        // --- Initialisation ---
        checkSession();
    });
    </script>
</body>
</html>